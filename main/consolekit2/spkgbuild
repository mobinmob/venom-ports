# description	: Framework for keeping track of the various users, sessions, and seats present on a system
# depends	: dbus-glib linux-pam polkit libx11

name=consolekit2
version=1.2.6
release=2
source="https://github.com/ConsoleKit2/ConsoleKit2/archive/$version/$name-$version.tar.gz
	pam-foreground-compat.ck consolekit.pam"

build() {
	cd ConsoleKit2-$version

	NOCONFIGURE=1 ./autogen.sh
	./configure \
		--prefix=/usr \
		--sysconfdir=/etc \
		--libexecdir=/usr/lib/$name \
		--localstatedir=/var \
		--disable-nls \
		--enable-udev-acl \
		--enable-pam-module \
		--enable-polkit \
		--with-xinitrc-dir=/etc/X11/app-defaults/xinitrc.d \
		--with-dbus-services=/usr/share/dbus-1/services \
		--with-dbus-sys=/usr/share/dbus-1/system.d \
		--with-pam-module-dir=/usr/lib/security \
		--with-systemdsystemunitdir=no
	make
	make DESTDIR=$PKG install

	mv -v $PKG/etc/X11/app-defaults/xinitrc.d/90-consolekit \
	      $PKG/etc/X11/app-defaults/xinitrc.d/90-consolekit.sh

	install -Dm 755 $SRC/pam-foreground-compat.ck \
	                $PKG/usr/lib/ConsoleKit/run-session.d/pam-foreground-compat.ck
	install -dm755 $PKG/etc/pam.d/ 
	install -Dm644 $SRC/consolekit.pam $PKG/etc/pam.d/consolekit
}
