# description	: Application sandboxing and distribution framework
# homepage	: https://flatpak.org/
# depends	: gpgme libarchive libcap libxml libostree json-glib libseccomp curl python3-pyparsing xdg-dbus-proxy dconf zstd socat polkit fuse3 gettext

name=flatpak
version=1.15.4
release=1
source="https://github.com/flatpak/flatpak/releases/download/${version}/flatpak-${version}.tar.xz"

build() {
	cd $name-$version
	venom-meson build \
		--auto-features=disabled \
		-Ddbus_config_dir=/usr/share/dbus-1/system.d \
		-Dsystem_bubblewrap=bwrap \
		-Dsystem_dbus_proxy=xdg-dbus-proxy \
		-Dsystem_helper_user=_flatpak \
		-Dselinux_module=disabled \
		-Dlibzstd=enabled \
		-Ddconf=enabled \
		-Dsystemd=disabled \
		-Dsystemdsystemunitdir='' \
		-Dsystemduserenvgendir='' \
		-Dsystemduserunitdir='' \
		-Dsysusersdir='' \
		-Dgdm_env_file=true \
		-Dtests=false 
	meson compile -C build
	DESTDIR=$PKG meson install --no-rebuild -C build
	# clean cruft
	rm -rf "$PKG/usr/lib/systemd"
}
